# HTTP에서의 압축
압축을 통해 웹 사이트의 성능을 높일 수 있다. 압축은 3개의 계층에서 일어난다.
1. 몇 개의 파일 형식이 최적화된 특유의 방법으로 압축된다.
2. HTTP 계층에서 일반적인 암호화가 일어난다. 리소스는 끝단 간에 압축되어 전송된다.
3. 찹툭이 HTTP 커넥션의 두 노드 사이의 커넥션 계층에서 정의될 수 있다.

## 파일 포맷 압축
각각의 데이터 타입은 안에 공간을 낭비할 수 있는 중복이 존재한다. 텍스트는 일반적으로 60% 정도, 오디오와 비디오에서는 더 높은 비율을 가질 수 있다. 이에 특정 목적을 위해 설계된 파일 포맷이 사용하는 최적화 압축 알고리즘을 설계했다.
- 무손실 압축: 압축-비압축 사이클이 복원된 데이터를 변경하지 않는 것을 말한다. 원래 데이터와 복원된 데이터가 일치한다. gif, png에서 무손실 압축을 사용한다.
- 손실 압축: 사용자가 인지하기 힘든 범위 내에서 원래의 데이터를 사이클이 변경하는 것. 웹에서의 비디오 포맷은 손실 압축이다. jpeg에서 사용한다.

품질을 유지하면서 가능한 많이 압축하는 것을 목표로 한다.
일반젓으로 손실 압축 알고리즘이 무손실 압축 알고리즘 보다 효과적이다.

## 종단 간 압축
종단간 압축은 웹 사이트의 가장 큰 성능 이득이 발생하는 곳이다. 종단 간 업축은 서버에 의해 처리되고 클라이언트에 도달할 때까지 결코 변하지 않을 메시지 바디의 압축을 나타낸다. 중간 노드에서는 바디를 건들이지 않는다.
![Alt text](/images/image2.png)</br>
gzip, br이 일반적으로 많이 사용하는 알고리즘이다. 

사용할 알고리즘은 브라우저와 서버 간의 사전 컨텐츠 협상을 사용해 선택한다. 브라우저는 브라우저가 지원하는 알고리즘과 우선순위를 Accept-Encoding 헤더에 전송하고, 서버는 그 헤더를 뽑아 응답의 바디를 압축하는데 사용하고 서버가 선택한 알고리즘을 Content-Encoding 헤더를 사용해 브라우저에게 알린다. 
![Alt text](/images/image3.png)</br>
Apache는 mod_deflate를, nginx는 ngx_http_gzip_module 모듈을, IIS는 <httpCompression> 엘리먼트를 지원한다.

## Hop-by-hop
서버 내에서 리소스 압축이 일어나지 않고, 클라이언트과 서버 사이의 경로 상에 있는 어떤 두 노드 사이에서 메시지 바디에 압축이 일어난다. 각 노드 간의 커넥션들에 다른 압축을 적용할 수 있다.
![Alt text](/images/image4.png)</br>
종단간 압축에서의 컨텐츠 협상과 유사한 메커니즘을 사용한다. 요청을 전송하는 노드는 요청이 TE헤더를 사용하고 있다는 것을 알리고 다른 노드들은 알맞는 방법을 선택해 적용하고 Transfer-Encoding 헤더를 사용해 선택한 내용을 가리킨다.
![Alt text](image.png)</br>
서버 단에서 구성하는 것은 어렵고, 일반적으로 프록시 계층에 적용된다.







</br></br></br></br></br></br></br>
---
- https://developer.mozilla.org/ko/docs/Web/HTTP/Compression
